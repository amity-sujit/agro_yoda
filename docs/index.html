
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crop Yield Choropleth</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; }
        #map { width: 800px; height: 600px; }
        #controls { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="controls">
        <label>Source:</label>
        <select id="sourceSelect" onchange="updateMap()">
            <option value="survey">Survey</option>
            <option value="census">Census</option>
        </select>
        <label>Crop:</label>
        <select id="cropSelect" onchange="updateMap()">
            <option value="SOYBEANS">Soybeans</option>
            <option value="SUGARBEETS">Sugarbeets</option>
            <option value="HAY">Hay</option>
            <option value="CORN">Corn</option>
            <option value="WHEAT">Wheat</option>
            <option value="SUNFLOWER">Sunflower</option>
            <option value="OATS">Oats</option>
            <option value="COTTON">Cotton</option>
            <option value="RYE">Rye</option>
            <option value="HAY & HAYLAGE">Hay & haylage</option>
            <option value="SUGARCANE">Sugarcane</option>
            <option value="BEANS">Beans</option>
            <option value="SORGHUM">Sorghum</option>
            <option value="BEDDING PLANTS, ANNUAL">Bedding plants, annual</option>
            <option value="POTATOES">Potatoes</option>
            <option value="GRAIN">Grain</option>
            <option value="TOBACCO">Tobacco</option>
            <option value="BARLEY">Barley</option>
            <option value="GREENS">Greens</option>
            <option value="HORTICULTURE TOTALS">Horticulture totals</option>
            <option value="TOMATOES">Tomatoes</option>
            <option value="FRUIT & TREE NUT TOTALS">Fruit & tree nut totals</option>
            <option value="VEGETABLE TOTALS">Vegetable totals</option>
            <option value="PUMPKINS">Pumpkins</option>
            <option value="BEDDING PLANTS, HERBACEOUS PERENNIAL">Bedding plants, herbaceous perennial</option>
            <option value="BLACKBERRIES">Blackberries</option>
            <option value="SQUASH">Squash</option>
            <option value="PECANS">Pecans</option>
            <option value="PASTURELAND">Pastureland</option>
            <option value="RICE">Rice</option>
            <option value="ORCHARDS">Orchards</option>
            <option value="BERRY TOTALS">Berry totals</option>
            <option value="FRUIT & NUT PLANTS">Fruit & nut plants</option>
            <option value="GRAPES">Grapes</option>
            <option value="APPLES">Apples</option>
            <option value="CUT CHRISTMAS TREES & SHORT TERM WOODY TREES">Cut christmas trees & short term woody trees</option>
            <option value="PEANUTS">Peanuts</option>
            <option value="SWEET CORN">Sweet corn</option>
            <option value="GRAIN STORAGE CAPACITY">Grain storage capacity</option>
            <option value="FLOWERING PLANTS, POTTED">Flowering plants, potted</option>
            <option value="TURNIPS">Turnips</option>
            <option value="TANGERINES">Tangerines</option>
            <option value="NURSERY TOTALS">Nursery totals</option>
            <option value="SWEET POTATOES">Sweet potatoes</option>
            <option value="FLAXSEED">Flaxseed</option>
            <option value="BLUEBERRIES">Blueberries</option>
            <option value="CUT CHRISTMAS TREES">Cut christmas trees</option>
            <option value="SOIL">Soil</option>
            <option value="FOLIAGE PLANTS">Foliage plants</option>
            <option value="MINT">Mint</option>
            <option value="BEETS">Beets</option>
            <option value="DECIDUOUS SHADE TREES">Deciduous shade trees</option>
            <option value="GRAPEFRUIT">Grapefruit</option>
            <option value="VEGETABLES, OTHER">Vegetables, other</option>
            <option value="FRUIT & TREE NUTS, OTHER">Fruit & tree nuts, other</option>
            <option value="PEAS">Peas</option>
            <option value="NECTARINES">Nectarines</option>
            <option value="TREE NUT TOTALS">Tree nut totals</option>
            <option value="LETTUCE">Lettuce</option>
            <option value="ORANGES">Oranges</option>
            <option value="CAKE & MEAL">Cake & meal</option>
            <option value="PEACHES">Peaches</option>
            <option value="CUCUMBERS">Cucumbers</option>
            <option value="CABBAGE">Cabbage</option>
            <option value="CROP TOTALS">Crop totals</option>
            <option value="FIELD CROPS, OTHER">Field crops, other</option>
            <option value="MAPLE SYRUP">Maple syrup</option>
            <option value="SHORT TERM WOODY TREES">Short term woody trees</option>
            <option value="HAYLAGE">Haylage</option>
            <option value="POPCORN">Popcorn</option>
            <option value="ONIONS">Onions</option>
            <option value="GRASSES">Grasses</option>
            <option value="PROPAGATIVE MATERIAL">Propagative material</option>
            <option value="MELONS">Melons</option>
            <option value="CAULIFLOWER">Cauliflower</option>
            <option value="NON-CITRUS TOTALS">Non-citrus totals</option>
            <option value="RASPBERRIES">Raspberries</option>
            <option value="PEPPERS">Peppers</option>
            <option value="GRASSES & LEGUMES TOTALS">Grasses & legumes totals</option>
            <option value="WOODY ORNAMENTALS & VINES, OTHER">Woody ornamentals & vines, other</option>
            <option value="CHESTNUTS">Chestnuts</option>
            <option value="FOOD GRAINS">Food grains</option>
            <option value="PISTACHIOS">Pistachios</option>
            <option value="POTATOES & DRY BEANS">Potatoes & dry beans</option>
            <option value="APRICOTS">Apricots</option>
            <option value="SAFFLOWER">Safflower</option>
            <option value="STRAWBERRIES">Strawberries</option>
            <option value="PEARS">Pears</option>
            <option value="AQUATIC PLANTS">Aquatic plants</option>
            <option value="CHERRIES">Cherries</option>
            <option value="FLORICULTURE TOTALS">Floriculture totals</option>
            <option value="HORTICULTURE, OTHER">Horticulture, other</option>
            <option value="DECIDUOUS FLOWERING TREES">Deciduous flowering trees</option>
            <option value="FRUIT TOTALS">Fruit totals</option>
            <option value="AVOCADOS">Avocados</option>
            <option value="PLUMS & PRUNES">Plums & prunes</option>
            <option value="CUT FLOWERS">Cut flowers</option>
            <option value="FIELDWORK">Fieldwork</option>
            <option value="TRANSPLANTS">Transplants</option>
            <option value="SPINACH">Spinach</option>
            <option value="MUSTARD">Mustard</option>
            <option value="HERBS">Herbs</option>
            <option value="LENTILS">Lentils</option>
            <option value="SMALL GRAINS">Small grains</option>
            <option value="WALNUTS">Walnuts</option>
            <option value="VEGETABLE SEEDS">Vegetable seeds</option>
            <option value="CROPS, OTHER">Crops, other</option>
            <option value="BEDDING PLANT TOTALS">Bedding plant totals</option>
            <option value="EVERGREENS, BROADLEAF">Evergreens, broadleaf</option>
            <option value="MUSHROOMS">Mushrooms</option>
            <option value="FIELD CROP TOTALS">Field crop totals</option>
            <option value="CARROTS">Carrots</option>
            <option value="BROCCOLI">Broccoli</option>
            <option value="HOPS">Hops</option>
            <option value="PERSIMMONS">Persimmons</option>
            <option value="COCONUTS">Coconuts</option>
            <option value="OKRA">Okra</option>
            <option value="DECIDUOUS SHRUBS">Deciduous shrubs</option>
            <option value="CRANBERRIES">Cranberries</option>
            <option value="EGGPLANT">Eggplant</option>
            <option value="GARLIC">Garlic</option>
            <option value="FIELD CROP & VEGETABLE TOTALS">Field crop & vegetable totals</option>
            <option value="TANGELOS">Tangelos</option>
            <option value="GUAVAS">Guavas</option>
            <option value="CANOLA">Canola</option>
            <option value="HORSERADISH">Horseradish</option>
            <option value="RADISHES">Radishes</option>
            <option value="BANANAS">Bananas</option>
            <option value="KUMQUATS">Kumquats</option>
            <option value="CUT FLOWERS & CUT CULTIVATED GREENS">Cut flowers & cut cultivated greens</option>
            <option value="EMMER & SPELT">Emmer & spelt</option>
            <option value="RHUBARB">Rhubarb</option>
            <option value="SOD">Sod</option>
            <option value="EVERGREENS, CONIFEROUS">Evergreens, coniferous</option>
            <option value="ALMONDS">Almonds</option>
            <option value="BUCKWHEAT">Buckwheat</option>
            <option value="HAZELNUTS">Hazelnuts</option>
            <option value="CITRUS TOTALS">Citrus totals</option>
            <option value="PLANTAINS">Plantains</option>
            <option value="FLOWER SEEDS">Flower seeds</option>
            <option value="TREE NUTS, OTHER">Tree nuts, other</option>
            <option value="COFFEE">Coffee</option>
            <option value="BULBS & CORMS & RHIZOMES & TUBERS">Bulbs & corms & rhizomes & tubers</option>
            <option value="CHICKPEAS">Chickpeas</option>
            <option value="BERRIES, OTHER">Berries, other</option>
            <option value="CUT CULTIVATED GREENS">Cut cultivated greens</option>
            <option value="PLUMS">Plums</option>
            <option value="NURSERY, OTHER">Nursery, other</option>
            <option value="BRUSSELS SPROUTS">Brussels sprouts</option>
            <option value="FIGS">Figs</option>
            <option value="GRASSES & LEGUMES, OTHER">Grasses & legumes, other</option>
            <option value="NON-CITRUS, OTHER">Non-citrus, other</option>
            <option value="ASPARAGUS">Asparagus</option>
            <option value="ELDERBERRIES">Elderberries</option>
            <option value="PACKING FACILITY">Packing facility</option>
            <option value="LEGUMES">Legumes</option>
            <option value="LEMONS">Lemons</option>
            <option value="PARSLEY">Parsley</option>
            <option value="LEMONS & LIMES">Lemons & limes</option>
            <option value="TRITICALE">Triticale</option>
            <option value="GINGER ROOT">Ginger root</option>
            <option value="TARO">Taro</option>
            <option value="MILLET">Millet</option>
            <option value="LOGANBERRIES">Loganberries</option>
            <option value="CHICORY">Chicory</option>
            <option value="RAPESEED">Rapeseed</option>
            <option value="FOOD CROP TOTALS">Food crop totals</option>
            <option value="GINSENG">Ginseng</option>
            <option value="FEED GRAINS & HAY">Feed grains & hay</option>
            <option value="CELERY">Celery</option>
            <option value="ARTICHOKES">Artichokes</option>
            <option value="KIWIFRUIT">Kiwifruit</option>
            <option value="VEGETABLES, MIXED">Vegetables, mixed</option>
            <option value="BOYSENBERRIES">Boysenberries</option>
            <option value="PRUNES">Prunes</option>
            <option value="ORNAMENTAL GRASSES">Ornamental grasses</option>
            <option value="FLORICULTURE, OTHER">Floriculture, other</option>
            <option value="TEMPLES">Temples</option>
            <option value="BAREROOT HERBACEOUS PERENNIALS">Bareroot herbaceous perennials</option>
            <option value="ARONIA BERRIES">Aronia berries</option>
            <option value="DILL">Dill</option>
            <option value="JOJOBA">Jojoba</option>
            <option value="ESCAROLE & ENDIVE">Escarole & endive</option>
            <option value="CURRANTS">Currants</option>
            <option value="HEMP">Hemp</option>
            <option value="LIMES">Limes</option>
            <option value="DAIKON">Daikon</option>
            <option value="FLOUR">Flour</option>
            <option value="COLD STORAGE CAPACITY">Cold storage capacity</option>
            <option value="ALCOHOL COPRODUCTS">Alcohol coproducts</option>
            <option value="OIL">Oil</option>
            <option value="PASSION FRUIT">Passion fruit</option>
            <option value="PINEAPPLES">Pineapples</option>
            <option value="OLIVES">Olives</option>
            <option value="FRUIT, OTHER">Fruit, other</option>
            <option value="POMEGRANATES">Pomegranates</option>
            <option value="MACADAMIAS">Macadamias</option>
            <option value="CHIRONJAS">Chironjas</option>
            <option value="OIL-BEARING CROPS">Oil-bearing crops</option>
            <option value="CITRUS, OTHER">Citrus, other</option>
            <option value="LAUPELE">Laupele</option>
            <option value="GUAR">Guar</option>
            <option value="SWITCHGRASS">Switchgrass</option>
            <option value="CAMELINA">Camelina</option>
            <option value="DATES">Dates</option>
            <option value="YAMS">Yams</option>
            <option value="SNOW">Snow</option>
            <option value="WATERCRESS">Watercress</option>
            <option value="NON-CITRUS FRUIT & TREE NUTS TOTALS">Non-citrus fruit & tree nuts totals</option>
            <option value="DASHEENS">Dasheens</option>
            <option value="SESAME">Sesame</option>
            <option value="MILLFEED">Millfeed</option>
            <option value="WILD RICE">Wild rice</option>
            <option value="MISCANTHUS">Miscanthus</option>
            <option value="FOOD CROP, OTHER">Food crop, other</option>
            <option value="SOURSOPS">Soursops</option>
            <option value="SWEETSOPS">Sweetsops</option>
            <option value="PAPAYAS">Papayas</option>
            <option value="MANGOES">Mangoes</option>
            <option value="BREADFRUIT">Breadfruit</option>
            <option value="PLUM-APRICOT HYBRIDS">Plum-apricot hybrids</option>
            <option value="QUENEPAS">Quenepas</option>
            <option value="ROOT CELERY">Root celery</option>
            <option value="PALMS">Palms</option>
            <option value="BETEL NUTS">Betel nuts</option>
            <option value="PEAS & CARROTS">Peas & carrots</option>
            <option value="PICKLES">Pickles</option>
            <option value="STARFRUIT">Starfruit</option>
            <option value="PEAS & LENTILS">Peas & lentils</option>
            <option value="CACTI & SUCCULENTS">Cacti & succulents</option>
            <option value="FEED GRAINS">Feed grains</option>
            <option value="KAVA">Kava</option>
            <option value="ROOT CROPS & TUBERS, OTHER">Root crops & tubers, other</option>
            <option value="CASSAVA">Cassava</option>
            <option value="GADO">Gado</option>
            <option value="BASIL">Basil</option>
            <option value="PIMIENTOS">Pimientos</option>
            <option value="MUSHROOM SPAWN">Mushroom spawn</option>
            <option value="SPROUTS">Sprouts</option>
            <option value="ROOTS & TUBERS">Roots & tubers</option>
            <option value="FIELD CROPS & VEGETABLES, OTHER">Field crops & vegetables, other</option>
            <option value="K-EARLY CITRUS">K-early citrus</option>
            <option value="CACAO">Cacao</option>
            <option value="CHERIMOYAS">Cherimoyas</option>
            <option value="CITRONS">Citrons</option>
            <option value="ORNAMENTAL TREE SEEDLINGS">Ornamental tree seedlings</option>
            <option value="BITTERMELON">Bittermelon</option>
            <option value="GOOSEBERRIES">Gooseberries</option>
            <option value="TANIERS">Taniers</option>
            <option value="SWEET RICE">Sweet rice</option>
            <option value="CRAMBE">Crambe</option>
            <option value="AMARANTH">Amaranth</option>
            <option value="CILANTRO">Cilantro</option>
            <option value="SORREL">Sorrel</option>
            <option value="ROOTS, OTHER">Roots, other</option>
            <option value="CORIANDER">Coriander</option>
            <option value="ROOT CROPS & TUBERS">Root crops & tubers</option>
            <option value="BULBS & ROOTS">Bulbs & roots</option>
            <option value="POINSETTIAS">Poinsettias</option>
            <option value="CRUDE PINE GUM">Crude pine gum</option>
            <option value="DRAGON FRUIT">Dragon fruit</option>
            <option value="LOTUS ROOT">Lotus root</option>
            <option value="SILAGE">Silage</option>
            <option value="CHIVES">Chives</option>
            <option value="FRUIT BEARING TREES">Fruit bearing trees</option>
            <option value="CANEBERRIES">Caneberries</option>
            <option value="HERBS & SPICES">Herbs & spices</option>
            <option value="LONGAN">Longan</option>
            <option value="LYCHEES">Lychees</option>
            <option value="GOURDS">Gourds</option>
            <option value="PAWPAWS">Pawpaws</option>
            <option value="MULBERRIES">Mulberries</option>
            <option value="PARSNIPS">Parsnips</option>
            <option value="RAMBUTAN">Rambutan</option>
            <option value="MOUNTAIN APPLES">Mountain apples</option>
        </select>
        <label>Year:</label>
        <select id="yearSelect" onchange="updateMap()">
            <option value="2020">2020</option>
            <option value="2021">2021</option>
            <option value="2022">2022</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
        </select>
    </div>
    <div id="map"></div>

    <script>
        let surveyData = {};

        function loadData() {
            const crop = document.getElementById('cropSelect').value;
            const source = document.getElementById('sourceSelect').value;
            const dataUrl = `data/${source}_${crop}_yield.geojson`;

            fetch(dataUrl)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    surveyData[crop] = data;
                    updateMap();
                })
                .catch(error => console.error('Error loading GeoJSON:', error));
        }

        function updateMap() {
            const source = document.getElementById('sourceSelect').value;
            const crop = document.getElementById('cropSelect').value;
            const year = document.getElementById('yearSelect').value;

            if (!surveyData[crop]) {
                loadData();
                return;
            }

            const filteredFeatures = surveyData[crop].features.filter(f => 
                f.properties.YEAR === parseInt(year)
            );
            const filteredData = {
                type: 'FeatureCollection',
                features: filteredFeatures
            };

            const states = filteredData.features.map(f => f.properties.STATE_ALPHA);
            const values = filteredData.features.map(f => f.properties.VALUE || 0);

            const data = [{
                type: 'choropleth',
                locations: states,
                locationmode: 'USA-states',
                z: values,
                colorscale: 'YlGn',
                autocolorscale: false,
                marker: { line: { color: 'black', width: 1 } },
                colorbar: { title: 'Yield (Units Vary)' }
            }];

            const layout = {
                title: `${source.toUpperCase()} ${crop} Yield by State (${year})`,
                geo: {
                    scope: 'usa',
                    framecolor: 'black',
                    showframe: true
                },
                width: 800,
                height: 600
            };

            Plotly.newPlot('map', data, layout);
        }

        updateMap();
    </script>
</body>
</html>
